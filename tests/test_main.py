from pathlib import Path
from pyxems.main import PyXEMSConfig, write_openEMS_xml
from pyxems.csx import Color
import logging


def test_generate_simp_patch(tmp_path: Path):
    logging.info(tmp_path)
    ref = Path(__file__).parent / "data" / "simp_patch.xml"
    oems_config = PyXEMSConfig()
    for i in (
        -100,
        -95.2525945022817,
        -90.5051890045634,
        -85.7577835068452,
        -81.0103780091269,
        -76.2629725114086,
        -71.5155670136903,
        -66.7681615159721,
        -62.0207560182538,
        -57.2733505205355,
        -52.5259450228173,
        -47.778539525099,
        -43.0311340273807,
        -38.2837285296624,
        -33.5363230319441,
        -30,
        -27.2275695831295,
        -24.4551391662589,
        -20.4945242850153,
        -17.6655136555556,
        -15.1672431722222,
        -13.0646644629969,
        -10.1210542700815,
        -6,
        -1.2149943387356,
        3.57001132252879,
        8.35501698379319,
        12.1528784939756,
        15.1672431722222,
        17.6655136555556,
        20.4945242850153,
        24.4551391662589,
        27.2275695831295,
        30,
        33.5363230319441,
        38.2837285296624,
        43.0311340273807,
        47.778539525099,
        52.5259450228173,
        57.2733505205355,
        62.0207560182538,
        66.7681615159721,
        71.5155670136903,
        76.2629725114086,
        81.0103780091269,
        85.7577835068452,
        90.5051890045634,
        95.2525945022817,
        100,
    ):
        oems_config.csx.add_line("X", i)
    for j in (
        -100,
        -95.3333333333333,
        -90.6666666666667,
        -86,
        -81.3333333333333,
        -76.6666666666667,
        -72,
        -67.3333333333333,
        -62.6666666666667,
        -58,
        -53.3333333333333,
        -48.6666666666667,
        -44,
        -39.3333333333333,
        -34.6666666666667,
        -30,
        -25.1382162990741,
        -21.6655136555556,
        -19.1672431722222,
        -16.4376925960031,
        -12.9986743682719,
        -8.66578291218129,
        -4.33289145609064,
        0,
        4.33289145609064,
        8.66578291218129,
        12.9986743682719,
        16.4376925960031,
        19.1672431722222,
        21.6655136555556,
        25.1382162990741,
        30,
        34.6666666666667,
        39.3333333333333,
        44,
        48.6666666666667,
        53.3333333333333,
        58,
        62.6666666666667,
        67.3333333333333,
        72,
        76.6666666666667,
        81.3333333333333,
        86,
        90.6666666666667,
        95.3333333333333,
        100,
    ):
        oems_config.csx.add_line("Y", j)
    for k in (
        -50,
        -45.1727844417033,
        -40.3455688834067,
        -35.5183533251101,
        -30.6911377668134,
        -25.8639222085168,
        -21.0367066502201,
        -16.2094910919235,
        -11.3822755336268,
        -7.88299603003119,
        -5.34634588536576,
        -3.50751193402824,
        -2.17452941466014,
        -1.20824184114188,
        -0.507773784607707,
        0,
        0.381,
        0.762,
        1.143,
        1.524,
        2.03282705193958,
        2.73474807856266,
        3.70304000749515,
        5.03878751194945,
        6.88143572819863,
        9.42334760714565,
        12.929885612259,
        17.7671141893557,
        22.6043427664524,
        27.4415713435491,
        32.2787999206459,
        37.1160284977426,
        41.9532570748393,
        46.790485651936,
        51.6277142290327,
        56.4649428061295,
        61.3021713832262,
        66.1393999603229,
        70.9766285374196,
        75.8138571145164,
        80.6510856916131,
        85.4883142687098,
        90.3255428458065,
        95.1627714229033,
        100,
    ):
        oems_config.csx.add_line("Z", k)
    oems_config.csx.add_property(
        "Metal", "patch", Color(41, 35, 190), Color(41, 35, 190, 255)
    )
    oems_config.csx.add_box(
        start=(-16, -20, 1.524),
        stop=(16, 20, 1.524),
        priority=10,
        property_id=0,
    )
    oems_config.csx.add_property(
        "Material",
        "substrate",
        Color(132, 225, 108, 123),
        Color(132, 225, 108, 123),
        eps=3.38,
        kappa=4.606928e-4,
    )
    oems_config.csx.add_box(
        start=(-30, -30, 0),
        stop=(30, 30, 1.524),
        priority=0,
        property_id=1,
    )
    oems_config.csx.add_property(
        "Metal",
        "gnd",
        Color(214, 174, 82),
        Color(214, 174, 82),
    )
    oems_config.csx.add_box(
        start=(-30, -30, 0),
        stop=(30, 30, 0),
        priority=10,
        property_id=2,
    )
    oems_config.csx.add_property("LumpedElement", "port_resist_1", Color(144, 73, 241))
    oems_config.csx.add_box(
        start=(-6, 0, 0),
        stop=(-6, 0, 1.524),
        priority=5,
        property_id=3,
    )
    write_openEMS_xml(tmp_path / "openEMS_config.xml", oems_config)
    assert (tmp_path / "openEMS_config.xml").read_text() == ref.read_text()
